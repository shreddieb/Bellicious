var ConfigurableMediaImages={imageType:null,productImages:{},imageObjects:{},arrayIntersect:function(e,a){for(var i=0,r=0,t=new Array;i<e.length&&r<a.length;)e[i]<a[r]?i++:e[i]>a[r]?r++:(t.push(e[i]),i++,r++);return t},getCompatibleProductImages:function(e,a){var i=[],r=[];return a.each(function(a){if(e.option_labels[a]){var t=e.option_labels[a].products;r.push(t),t.each(function(e){i.push(e)})}}),r.each(function(e){i=ConfigurableMediaImages.arrayIntersect(i,e)}),i},isValidImage:function(e){return e?!0:!1},getSwatchImage:function(e,a,i){var r=ConfigurableMediaImages.productImages[e];if(!r)return null;var t=r.option_labels[a];if(t&&r.option_labels[a].configurable_product[ConfigurableMediaImages.imageType])return r.option_labels[a].configurable_product[ConfigurableMediaImages.imageType];var n=ConfigurableMediaImages.getCompatibleProductImages(r,i);if(0==n.length)return null;jQuery.each(r.option_labels,function(e,a){var i=a.configurable_product[ConfigurableMediaImages.imageType],r=a.products;if(i){var t=ConfigurableMediaImages.arrayIntersect(r,n).length>0;if(t)return i}});var o=null,g=r[ConfigurableMediaImages.imageType];return n.each(function(e){return g[e]&&ConfigurableMediaImages.isValidImage(g[e])?(o=g[e],!1):void 0}),o?o:g[e]&&ConfigurableMediaImages.isValidImage(g[e])?g[e]:null},getImageObject:function(e,a){var i=e+"-"+a;if(!ConfigurableMediaImages.imageObjects[i]){var r=jQuery("<img />");r.attr("src",a),ConfigurableMediaImages.imageObjects[i]=r}return ConfigurableMediaImages.imageObjects[i]},updateImage:function(e){var a=jQuery(e),i=a.find("option:selected").attr("data-label"),r=optionsPrice.productId,t=new Array;jQuery(".product-options .super-attribute-select").each(function(){var e=jQuery(this);""!=e.val()&&t.push(e.find("option:selected").attr("data-label"))});var n=ConfigurableMediaImages.getSwatchImage(r,i,t);if(ConfigurableMediaImages.isValidImage(n)){var o=ConfigurableMediaImages.getImageObject(r,n);ProductMediaManager.swapImage(o)}},wireOptions:function(){jQuery(".product-options .super-attribute-select").change(function(){ConfigurableMediaImages.updateImage(this)})},swapListImage:function(e,a){var i=jQuery("#product-collection-image-"+e);if(a[0].complete)i.addClass("hidden"),jQuery(".product-collection-image-"+e).remove(),a.insertAfter(i);else{var r=i.parent();r.addClass("loading"),imagesLoaded(a,function(){r.removeClass("loading"),i.addClass("hidden"),jQuery(".product-collection-image-"+e).remove(),a.insertAfter(i)})}},swapListImageByOption:function(e,a){var i=ConfigurableMediaImages.getSwatchImage(e,a,[a]);if(i){var r=ConfigurableMediaImages.getImageObject(e,i);r.addClass("product-collection-image-"+e),ConfigurableMediaImages.swapListImage(e,r)}},setImageFallback:function(e,a){ConfigurableMediaImages.productImages[e]=a},init:function(e){ConfigurableMediaImages.imageType=e,ConfigurableMediaImages.wireOptions()}};